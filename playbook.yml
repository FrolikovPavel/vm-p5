---
- hosts: all
  become: no
  tasks:
  - name: Task 1
    block:
      - name: Get current time
        ansible.builtin.command: date +"%Y-%m-%d %H:%M:%S"
        register: current_time
        changed_when: false
        
      - name: Write current time
        ansible.builtin.copy:
          content: "{{ current_time.stdout }}\n"
          dest: "~/time"
          mode: '0644'
          
      - name: Write username
        ansible.builtin.copy:
          content: "{{ ansible_user_id }}\n"
          dest: "~/username"
          mode: '0644'
  
  - name: Task 2
    block:
     - name: Install unzip
       apt:
         name: "unzip={{ unzip_version }}"
         state: present
    become: yes
  
  - name: Task 3
    block:
      - name: Install required system packages
        apt:
          name:
            - apt-transport-https
            - ca-certificates
            - curl
            - software-properties-common
            - virtualenv
          state: latest
          update_cache: yes

      - name: Add Docker GPG apt Key
        apt_key:
          url: https://download.docker.com/linux/ubuntu/gpg
          state: present

      - name: Add Docker Repository
        apt_repository:
          repo: deb https://download.docker.com/linux/ubuntu jammy stable
          state: present

      - name: Update apt and install Docker packages
        apt:
          name:
            - docker-ce
            - docker-ce-cli
            - containerd.io
            - docker-compose
          state: latest
          update_cache: yes
    become: yes